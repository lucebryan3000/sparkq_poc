<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>SparkQ</title>
  <script src="/ui-cache-buster.js"></script>
  <script>
    (function() {
      const env = window.__SPARKQ_ENV__ || 'dev';
      const buildId = window.__SPARKQ_BUILD_ID__ || window.__BUILD_ID__ || 'dev';
      window.__BUILD_ID__ = buildId;
      const isDevLike = env === 'dev' || env === 'test';
      const cacheBuster = isDevLike ? (window.__SPARKQ_CACHE_BUSTER__ || 'dev') : '';
      const versionQuery = cacheBuster ? `?v=${cacheBuster}` : '';
      const stylesheet = document.createElement('link');
      stylesheet.rel = 'stylesheet';
      stylesheet.href = `/ui/style.css${versionQuery}`;
      document.head.appendChild(stylesheet);
    })();
  </script>
  <noscript><link rel="stylesheet" href="/ui/style.css"></noscript>
</head>
<body>
  <header class='app-header'>
    <div class='header-left'>
      <button class='hamburger-btn' id='menu-toggle' aria-label='Toggle menu'>
        <span></span>
        <span></span>
        <span></span>
      </button>
      <button class='navbar-brand' id='navbar-brand-btn' aria-label='Go to dashboard'>SparkQueue</button>
    </div>
    <div class='header-right'>
      <span id="build-id" style="font-size: 11px; color: #9ca3af; margin-right: 8px;"></span>
      <button class='button secondary' id='theme-toggle-btn' title='Toggle dark/light mode' style='padding: 6px 12px; font-size: 14px;'>ðŸŒ™</button>
    </div>
  </header>

  <nav class='hamburger-menu' id='nav-menu'>
    <button class='nav-tab active' data-tab='dashboard'>Dashboard</button>
    <button class='nav-tab' data-tab='sparkqueue'>SparkQueue</button>
    <button class='nav-tab' data-tab='enqueue'>Enqueue</button>
    <button class='nav-tab' data-tab='config'>Config</button>
    <button class='nav-tab' data-tab='scripts'>Scripts</button>
  </nav>

  <main id='app' class='container'>
    <div id='dashboard-page' class='page-content'></div>
    <div id='sparkqueue-page' class='page-content'></div>
    <div id='enqueue-page' class='page-content'></div>
    <div id='config-page' class='page-content'></div>
    <div id='scripts-page' class='page-content'></div>
  </main>

  <div id='breadcrumbs' class='breadcrumbs'></div>

  <script>
    (function() {
      const env = window.__SPARKQ_ENV__ || 'dev';
      const isDevLike = env === 'dev' || env === 'test';
      const cacheBuster = isDevLike ? (window.__SPARKQ_CACHE_BUSTER__ || 'dev') : '';
      const versionQuery = cacheBuster ? `?v=${cacheBuster}` : '';
      const assets = [
        "/ui/dist/app-core.js",
        "/ui/dist/ui-utils.js",
        "/ui/dist/quick-add.js",
        "/ui/dist/dashboard.js",
        "/ui/dist/queues.js",
        "/ui/dist/enqueue.js",
        "/ui/dist/config.js",
        "/ui/dist/scripts.js",
      ].map((src) => `${src}${versionQuery}`);

      const loadSequentially = (paths) =>
        paths.reduce(
          (chain, path) =>
            chain.then(
              () =>
                new Promise((resolve) => {
                  const script = document.createElement('script');
                  script.src = path;
                  script.async = false;
                  script.onload = () => resolve();
                  script.onerror = (err) => {
                    console.error('Failed to load UI asset', path, err);
                    resolve();
                  };
                  document.body.appendChild(script);
                }),
            ),
          Promise.resolve(),
        );

      loadSequentially(assets).catch((err) => console.error('Failed to load UI assets', err));

      const el = document.getElementById('build-id');
      const buildId = window.__SPARKQ_BUILD_ID__ || window.__BUILD_ID__;
      if (el && buildId) {
        el.textContent = `UI v${buildId}`;
      }
    })();
  </script>
</body>
</html>
